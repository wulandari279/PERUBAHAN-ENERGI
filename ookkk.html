<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPAS Interaktif - Kelas 4</title>
    <!-- Chosen Palette: Calm Harmony (Light blue-gray background, warm neutrals, soft blue and green accents) -->
    <!-- Application Structure Plan: The SPA uses a thematic, non-linear dashboard structure with four main sections: Dunia Energi & Gaya, Bumiku & Lingkunganku, Kekayaan Indonesiaku, and Aku & Masyarakat. This structure is chosen over a linear chapter-based layout to be more engaging and intuitive for 4th-grade students, allowing them to freely explore topics of interest. User flow begins with a visual grid of themes, leading to interactive modules within each section (e.g., animated diagrams, simple games, calculators), promoting discovery-based learning rather than passive reading. -->
    <!-- Visualization & Content Choices: 1. Energy Transformation: Goal(Inform) -> Animated Diagram(Canvas) + Audio -> Click to trigger animation and sound -> Justification(Visually and audibly explains abstract energy changes) -> Method(Native Canvas API + Tone.js). 2. Greenhouse Effect: Goal(Inform/Engage) -> Interactive Diagram with Slider(Canvas) -> User changes CO2 level, temperature visualization updates -> Justification(Demonstrates cause and effect of an important environmental issue) -> Method(Native Canvas API). 3. Cultural Diversity: Goal(Explore) -> Interactive Map/Gallery(HTML/CSS/JS) + Images -> Click province to see details and related image -> Justification(Provides an engaging, non-linear way to explore rich cultural data with visual context) -> Method(JS DOM Manipulation + Placeholder Images). All visualizations use Canvas or structured HTML/CSS, avoiding SVG and Mermaid JS as required. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
        }
        .theme-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .theme-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .sub-topic-button {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .sub-topic-button:hover {
            transform: scale(1.05);
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            max-height: 40vh;
            width: 100%;
            max-width: 500px;
        }
        .culture-image {
            width: 100%;
            height: 150px; /* Fixed height for consistency */
            object-fit: cover; /* Cover the area, cropping if necessary */
            border-radius: 8px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600">IPAS Seru!</div>
            <div class="hidden md:flex space-x-6">
                <a href="#dunia-energi" class="text-slate-600 hover:text-blue-600">Energi & Gaya</a>
                <a href="#bumiku" class="text-slate-600 hover:text-blue-600">Bumiku</a>
                <a href="#kekayaan-indonesia" class="text-slate-600 hover:text-blue-600">Kekayaan Indonesia</a>
                <a href="#aku-masyarakat" class="text-slate-600 hover:text-blue-600">Aku & Masyarakat</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <!-- Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-800">Selamat Datang, Penjelajah Cilik!</h1>
            <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">Ayo kita jelajahi dunia Ilmu Pengetahuan Alam dan Sosial yang penuh keajaiban. Pilih topik yang kamu suka!</p>
        </section>

        <!-- Theme Cards Navigation -->
        <section id="jelajah" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-20">
            <!-- Card 1: Energi & Gaya -->
            <a href="#dunia-energi" class="theme-card block bg-white p-8 rounded-2xl shadow-lg text-center border-t-4 border-amber-400">
                <div class="text-6xl mb-4">⚡️</div>
                <h3 class="text-2xl font-bold text-slate-800">Dunia Energi & Gaya</h3>
                <p class="text-slate-500 mt-2">Bagaimana benda bergerak dan berubah?</p>
            </a>
            <!-- Card 2: Bumiku -->
            <a href="#bumiku" class="theme-card block bg-white p-8 rounded-2xl shadow-lg text-center border-t-4 border-sky-400">
                <div class="text-6xl mb-4">🌍</div>
                <h3 class="text-2xl font-bold text-slate-800">Bumiku & Lingkunganku</h3>
                <p class="text-slate-500 mt-2">Mengenal planet kita dan cara menjaganya.</p>
            </a>
            <!-- Card 3: Kekayaan Indonesia -->
            <a href="#kekayaan-indonesia" class="theme-card block bg-white p-8 rounded-2xl shadow-lg text-center border-t-4 border-emerald-400">
                <div class="text-6xl mb-4">🏞️</div>
                <h3 class="text-2xl font-bold text-slate-800">Kekayaan Indonesiaku</h3>
                <p class="text-slate-500 mt-2">Keindahan alam, budaya, dan isinya.</p>
            </a>
            <!-- Card 4: Aku & Masyarakat -->
            <a href="#aku-masyarakat" class="theme-card block bg-white p-8 rounded-2xl shadow-lg text-center border-t-4 border-rose-400">
                <div class="text-6xl mb-4">🧑‍🤝‍🧑</div>
                <h3 class="text-2xl font-bold text-slate-800">Aku & Masyarakat</h3>
                <p class="text-slate-500 mt-2">Peran dan tanggung jawab kita bersama.</p>
            </a>
        </section>

        <!-- Detailed Sections -->
        <div class="space-y-20">

            <!-- Section 1: Dunia Energi & Gaya -->
            <section id="dunia-energi" class="bg-white p-8 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-bold text-center mb-8">⚡️ Dunia Energi & Gaya</h2>
                <p class="text-center text-slate-600 max-w-3xl mx-auto mb-12">Energi membuat segalanya terjadi, mulai dari lampu yang menyala hingga kita yang bisa berlari. Gaya adalah dorongan dan tarikan yang membuat benda-benda bergerak. Mari kita lihat bagaimana mereka bekerja!</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                    <!-- Perubahan Energi -->
                    <div class="bg-amber-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Perubahan Energi</h3>
                        <p class="text-slate-600 mb-4">Energi tidak bisa hilang, tapi bisa berubah bentuk. Coba klik tombol di bawah untuk melihat contohnya!</p>
                        <canvas id="energyCanvas" class="w-full bg-white rounded-lg shadow-inner" width="400" height="250"></canvas>
                        <div id="energyButtons" class="mt-4 flex flex-wrap gap-2 justify-center"></div>
                    </div>
                    <!-- Gaya Gesek -->
                    <div class="bg-amber-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Uji Gaya Gesek</h3>
                        <p class="text-slate-600 mb-4">Gaya gesek bisa memperlambat benda. Apa yang terjadi jika kita beri roda?</p>
                        <div id="friction-sim" class="bg-white p-4 rounded-lg shadow-inner h-[250px] flex flex-col justify-end relative overflow-hidden">
                            <div id="friction-surface" class="h-10 bg-gray-300 w-full absolute bottom-0 left-0"></div>
                            <div id="friction-box" class="w-16 h-16 bg-red-500 rounded-lg absolute bottom-10 left-4 flex flex-col justify-end items-center" style="transition: left 2s ease-in-out;">
                                <div id="friction-wheels" class="flex gap-1 opacity-0" style="transition: opacity 0.5s;">
                                    <div class="w-4 h-4 bg-gray-700 rounded-full"></div>
                                    <div class="w-4 h-4 bg-gray-700 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 flex gap-2 justify-center">
                            <button id="pushBtn" class="sub-topic-button bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Dorong Kotak</button>
                            <button id="addWheelsBtn" class="sub-topic-button bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Pasang Roda</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Bumiku & Lingkunganku -->
            <section id="bumiku" class="bg-white p-8 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-bold text-center mb-8">🌍 Bumiku & Lingkunganku</h2>
                <p class="text-center text-slate-600 max-w-3xl mx-auto mb-12">Bumi adalah rumah kita. Ada banyak hal luar biasa di dalamnya, seperti iklim dan cuaca. Sayangnya, rumah kita ini sedang menghadapi masalah seperti pemanasan global. Yuk, kita pelajari agar bisa menjadi pahlawan bagi Bumi!</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                    <!-- Efek Rumah Kaca -->
                    <div class="bg-sky-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Simulasi Efek Rumah Kaca</h3>
                        <p class="text-slate-600 mb-4">Gas karbon (CO2) di udara bisa memerangkap panas matahari dan membuat Bumi lebih hangat. Geser slider untuk melihat apa yang terjadi!</p>
                        <canvas id="greenhouseCanvas" class="w-full bg-white rounded-lg shadow-inner" width="400" height="300"></canvas>
                        <div class="mt-4">
                            <label for="co2Slider" class="font-bold">Tingkat CO2:</label>
                            <input type="range" id="co2Slider" min="1" max="10" value="3" class="w-full">
                        </div>
                    </div>
                    <!-- Jejak Karbon -->
                    <div class="bg-sky-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-4">Hitung Jejak Karbonmu!</h3>
                        <p class="text-slate-600 mb-4">Setiap kegiatan kita meninggalkan "jejak karbon". Semakin kecil jejaknya, semakin baik untuk Bumi. Cek kegiatanmu hari ini!</p>
                        <div id="carbon-quiz" class="space-y-2 mb-4">
                            <div><label><input type="checkbox" data-carbon="30" class="carbon-item"> Memakai AC > 1 jam</label></div>
                            <div><label><input type="checkbox" data-carbon="50" class="carbon-item"> Pergi naik mobil</label></div>
                            <div><label><input type="checkbox" data-carbon="20" class="carbon-item"> Banyak jajan kemasan plastik</label></div>
                            <div><label><input type="checkbox" data-carbon="-25" class="carbon-item"> Membawa botol minum sendiri</label></div>
                        </div>
                        <div class="chart-container">
                            <canvas id="carbonChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Kekayaan Indonesiaku -->
            <section id="kekayaan-indonesia" class="bg-white p-8 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-bold text-center mb-8">🏞️ Kekayaan Indonesiaku</h2>
                <p class="text-center text-slate-600 max-w-3xl mx-auto mb-12">Indonesia sangat kaya! Dari Sabang sampai Merauke, kita punya ribuan pulau, satwa unik, dan budaya yang beragam. Ini adalah harta yang harus kita kenal dan jaga bersama.</p>
                <div class="bg-emerald-50 p-6 rounded-xl">
                    <h3 class="text-xl font-bold mb-4">Jelajahi Keragaman Budaya</h3>
                    <p class="text-slate-600 mb-6">Setiap daerah punya ciri khasnya. Klik tombol di bawah untuk melihat kekayaan dari berbagai daerah di Indonesia!</p>
                    <div id="culture-buttons" class="flex flex-wrap gap-3 justify-center mb-6"></div>
                    <div id="culture-display" class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-white p-6 rounded-lg shadow-inner min-h-[200px] items-center text-center">
                        <!-- Content updated by JS -->
                    </div>
                </div>
            </section>

            <!-- Section 4: Aku & Masyarakat -->
            <section id="aku-masyarakat" class="bg-white p-8 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-bold text-center mb-8">🧑‍🤝‍🧑 Aku & Masyarakat</h2>
                <p class="text-center text-slate-600 max-w-3xl mx-auto mb-12">Kita semua adalah bagian dari masyarakat. Setiap orang punya peran dan tanggung jawab agar lingkungan kita menjadi tempat yang nyaman dan tertib. Ayo cocokkan peran dan tanggung jawabnya!</p>
                <div class="bg-rose-50 p-6 rounded-xl">
                    <h3 class="text-xl font-bold mb-4">Permainan Peran & Tanggung Jawab</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Roles -->
                        <div>
                            <h4 class="font-bold text-lg mb-2">Peran</h4>
                            <div id="roles-container" class="space-y-2">
                                <div id="role-siswa" class="p-4 bg-white rounded-lg shadow" data-role="Siswa">Siswa</div>
                                <div id="role-anak" class="p-4 bg-white rounded-lg shadow" data-role="Anak">Anak di Rumah</div>
                                <div id="role-warga" class="p-4 bg-white rounded-lg shadow" data-role="Warga">Warga Masyarakat</div>
                            </div>
                        </div>
                        <!-- Responsibilities -->
                        <div>
                            <h4 class="font-bold text-lg mb-2">Tanggung Jawab (Seret ke sini!)</h4>
                            <div id="drop-container" class="space-y-2">
                                <div class="drop-zone h-20 p-4 bg-rose-100 border-2 border-dashed border-rose-300 rounded-lg flex items-center justify-center text-slate-500" data-role="Siswa">Area Siswa</div>
                                <div class="drop-zone h-20 p-4 bg-rose-100 border-2 border-dashed border-rose-300 rounded-lg flex items-center justify-center text-slate-500" data-role="Anak">Area Anak</div>
                                <div class="drop-zone h-20 p-4 bg-rose-100 border-2 border-dashed border-rose-300 rounded-lg flex items-center justify-center text-slate-500" data-role="Warga">Area Warga</div>
                            </div>
                        </div>
                    </div>
                    <div id="responsibilities-container" class="flex flex-wrap gap-2 mt-6 justify-center">
                        <!-- Draggable items will be injected by JS -->
                    </div>
                     <div id="feedback-message" class="text-center mt-4 font-bold h-6"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-white mt-20 py-8">
        <div class="container mx-auto px-6 text-center">
            <p>Dibuat dengan ❤️ untuk Penjelajah Cilik Indonesia.</p>
            <p class="text-sm text-slate-400 mt-2">Aplikasi Interaktif berdasarkan Buku IPAS Kelas IV (Edisi Revisi) Kemdikbudristek.</p>
        </div>
    </footer>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Section 1: Energi & Gaya ---

        // 1a. Perubahan Energi Canvas
        const energyCanvas = document.getElementById('energyCanvas');
        const energyButtonsContainer = document.getElementById('energyButtons');
        const eCtx = energyCanvas.getContext('2d');
        // Inisialisasi Tone.js
        const synth = new Tone.Synth().toDestination();

        const energyTransformations = [
            { name: 'Lampu', from: 'Listrik ⚡️', to: 'Cahaya 💡', color: '#facc15', audioNote: 'C4' },
            { name: 'Kipas', from: 'Listrik ⚡️', to: 'Gerak 🌬️', color: '#38bdf8', audioNote: 'D4' },
            { name: 'Mobil', from: 'Kimia (Bensin) 🔥', to: 'Gerak 🚗', color: '#f87171', audioNote: 'E4' },
            { name: 'Fotosintesis', from: 'Cahaya ☀️', to: 'Kimia (Makanan) 🌱', color: '#4ade80', audioNote: 'F4' },
            { name: 'Manusia', from: 'Kimia (Makanan) 🍎', to: 'Gerak 🏃', color: '#fb923c', audioNote: 'G4' },
        ];

        let currentEnergyAnimation;

        function drawEnergy(progress, from, to) {
            eCtx.clearRect(0, 0, energyCanvas.width, energyCanvas.height);
            eCtx.font = 'bold 24px Nunito';
            eCtx.textAlign = 'center';
            
            const startX = 100;
            const endX = 300;
            const y = 100;
            
            const currentX = startX + (endX - startX) * progress;

            // Gambar jalur
            eCtx.beginPath();
            eCtx.moveTo(startX, y + 20);
            eCtx.lineTo(endX, y + 20);
            eCtx.strokeStyle = '#e5e7eb';
            eCtx.lineWidth = 4;
            eCtx.stroke();
            
            // Gambar progres
            eCtx.beginPath();
            eCtx.moveTo(startX, y + 20);
            eCtx.lineTo(currentX, y + 20);
            eCtx.strokeStyle = '#4b5563';
            eCtx.lineWidth = 4;
            eCtx.stroke();

            // Gambar teks
            eCtx.fillStyle = '#4b5563';
            eCtx.fillText(from, startX, y - 20);
            eCtx.fillText(to, endX, y - 20);
            
            // Gambar panah bergerak
            eCtx.font = '36px Nunito';
            eCtx.fillText('➡️', currentX, y);
            
            // Gambar deskripsi
            eCtx.font = '16px Nunito';
            eCtx.fillStyle = '#6b7280';
            eCtx.fillText(`Energi ${from} berubah menjadi Energi ${to}`, 200, 180);
        }

        function animateEnergy(from, to, audioNote) {
            if(currentEnergyAnimation) cancelAnimationFrame(currentEnergyAnimation);
            let start = null;
            const duration = 2000;
            
            // Mainkan suara saat animasi dimulai
            if (audioNote) {
                synth.triggerAttackRelease(audioNote, '8n');
            }

            function step(timestamp) {
                if (!start) start = timestamp;
                const elapsed = timestamp - start;
                const progress = Math.min(elapsed / duration, 1);
                
                drawEnergy(progress, from, to);
                
                if (progress < 1) {
                    currentEnergyAnimation = requestAnimationFrame(step);
                }
            }
            currentEnergyAnimation = requestAnimationFrame(step);
        }

        energyTransformations.forEach(t => {
            const button = document.createElement('button');
            button.className = 'sub-topic-button text-white font-bold py-2 px-4 rounded-lg';
            button.textContent = t.name;
            button.style.backgroundColor = t.color;
            button.onclick = () => animateEnergy(t.from, t.to, t.audioNote);
            energyButtonsContainer.appendChild(button);
        });

        // Gambar awal
        drawEnergy(0, 'Listrik ⚡️', 'Cahaya 💡');

        // 1b. Simulasi Gaya Gesek
        const frictionBox = document.getElementById('friction-box');
        const frictionWheels = document.getElementById('friction-wheels');
        const pushBtn = document.getElementById('pushBtn');
        const addWheelsBtn = document.getElementById('addWheelsBtn');
        let hasWheels = false;

        pushBtn.addEventListener('click', () => {
            frictionBox.style.transition = `left ${hasWheels ? 0.8 : 2}s ease-in-out`;
            frictionBox.style.left = 'calc(100% - 80px)';
            // Mainkan suara saat kotak didorong
            synth.triggerAttackRelease('C3', '8n');
            setTimeout(() => {
                frictionBox.style.transition = 'left 0.5s ease-in-out';
                frictionBox.style.left = '16px';
            }, hasWheels ? 1000 : 2200);
        });
        
        addWheelsBtn.addEventListener('click', () => {
            hasWheels = !hasWheels;
            frictionWheels.style.opacity = hasWheels ? '1' : '0';
            addWheelsBtn.textContent = hasWheels ? 'Lepas Roda' : 'Pasang Roda';
            addWheelsBtn.classList.toggle('bg-gray-500');
            addWheelsBtn.classList.toggle('bg-blue-500');
            // Mainkan suara saat roda dipasang/dilepas
            synth.triggerAttackRelease('G3', '8n');
        });

        // --- Section 2: Bumiku & Lingkunganku ---
        
        // 2a. Kanvas Efek Rumah Kaca
        const greenhouseCanvas = document.getElementById('greenhouseCanvas');
        const gCtx = greenhouseCanvas.getContext('2d');
        const co2Slider = document.getElementById('co2Slider');
        
        function drawGreenhouse(co2Level) {
            const width = greenhouseCanvas.width;
            const height = greenhouseCanvas.height;
            gCtx.clearRect(0, 0, width, height);

            // Gambar Bumi
            gCtx.fillStyle = '#22c55e'; // Hijau untuk daratan
            gCtx.beginPath();
            gCtx.arc(width / 2, height + 100, 150, Math.PI, 2 * Math.PI);
            gCtx.fill();

            // Gambar Atmosfer
            const atmosphereThickness = 20 + co2Level * 3;
            gCtx.fillStyle = `rgba(135, 206, 250, ${0.3 + co2Level * 0.04})`;
            gCtx.beginPath();
            gCtx.arc(width / 2, height + 100, 190, Math.PI, 2 * Math.PI);
            gCtx.fill();
            gCtx.font = '14px Nunito';
            gCtx.fillStyle = '#0369a1';
            gCtx.fillText('Atmosfer', width / 2, 60);

            // Gambar Matahari
            gCtx.fillStyle = '#fde047';
            gCtx.beginPath();
            gCtx.arc(50, 50, 30, 0, 2 * Math.PI);
            gCtx.fill();
            gCtx.font = '24px Nunito';
            gCtx.fillText('☀️', 50, 58);


            // Gambar Sinar Matahari
            const rays = 5;
            let heatTrapped = 0;
            for(let i=0; i < rays; i++) {
                gCtx.beginPath();
                gCtx.moveTo(70, 70);
                let endX = 100 + i * 45;
                let endY = height - 50;
                gCtx.lineTo(endX, endY);
                gCtx.strokeStyle = '#fef08a';
                gCtx.lineWidth = 2;
                gCtx.stroke();
                
                // Sinar yang dipantulkan
                const trapChance = co2Level / 12;
                if(Math.random() < trapChance) {
                    // Terperangkap
                    heatTrapped++;
                    gCtx.beginPath();
                    gCtx.moveTo(endX, endY);
                    gCtx.lineTo(endX + (Math.random() - 0.5) * 40, endY - 50);
                    gCtx.strokeStyle = '#ef4444';
                    gCtx.stroke();
                } else {
                    // Lolos
                    gCtx.beginPath();
                    gCtx.moveTo(endX, endY);
                    gCtx.lineTo(endX + (Math.random() - 0.5) * 20, 20);
                    gCtx.strokeStyle = '#a3a3a3';
                    gCtx.stroke();
                }
            }

            // Indikator Suhu
            const temp = 15 + co2Level * 1.5;
            gCtx.fillStyle = temp > 25 ? '#ef4444' : '#0ea5e9';
            gCtx.font = 'bold 20px Nunito';
            gCtx.textAlign = 'right';
            gCtx.fillText(`Suhu: ${temp.toFixed(1)}°C 🌡️`, width - 20, 40);
            gCtx.textAlign = 'center';
        }
        
        co2Slider.addEventListener('input', () => {
            drawGreenhouse(parseInt(co2Slider.value));
            // Mainkan suara saat slider digeser
            synth.triggerAttackRelease('A2', '16n');
        });
        
        drawGreenhouse(parseInt(co2Slider.value));

        // 2b. Chart.js Jejak Karbon
        const carbonItems = document.querySelectorAll('.carbon-item');
        const carbonChartCtx = document.getElementById('carbonChart').getContext('2d');
        let carbonChart = new Chart(carbonChartCtx, {
            type: 'bar',
            data: {
                labels: ['Jejak Karbonmu'],
                datasets: [{
                    label: 'Poin Karbon',
                    data: [0],
                    backgroundColor: ['#34d399'],
                    borderColor: ['#059669'],
                    borderWidth: 1
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        suggestedMax: 100
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' poin';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
        
        function updateCarbonChart() {
            let totalCarbon = 10; // Skor dasar
            carbonItems.forEach(item => {
                if (item.checked) {
                    totalCarbon += parseInt(item.dataset.carbon);
                }
            });

            carbonChart.data.datasets[0].data[0] = totalCarbon;
            if(totalCarbon > 60) {
                 carbonChart.data.datasets[0].backgroundColor[0] = '#ef4444'; // merah
                 carbonChart.data.datasets[0].borderColor[0] = '#b91c1c';
            } else if (totalCarbon > 30) {
                carbonChart.data.datasets[0].backgroundColor[0] = '#f59e0b'; // kuning
                 carbonChart.data.datasets[0].borderColor[0] = '#b45309';
            } else {
                carbonChart.data.datasets[0].backgroundColor[0] = '#34d399'; // hijau
                 carbonChart.data.datasets[0].borderColor[0] = '#059669';
            }
            carbonChart.update();
        }

        carbonItems.forEach(item => {
            item.addEventListener('change', updateCarbonChart);
        });
        
        updateCarbonChart();

        // --- Section 3: Kekayaan Indonesiaku ---
        const cultureButtonsContainer = document.getElementById('culture-buttons');
        const cultureDisplay = document.getElementById('culture-display');
        const cultureData = {
            'Sumatra': {
                icon: '🏠',
                title: 'Rumah Gadang',
                description: 'Rumah adat Minangkabau yang ikonik dengan atap gonjongnya.',
                color: '#f97316',
                imageUrl: 'https://placehold.co/400x200/f97316/ffffff?text=Rumah+Gadang'
            },
            'Jawa': {
                icon: '🎭',
                title: 'Wayang Kulit',
                description: 'Seni pertunjukan tradisional dengan boneka kulit dan gamelan.',
                color: '#ca8a04',
                imageUrl: 'https://placehold.co/400x200/ca8a04/ffffff?text=Wayang+Kulit'
            },
            'Kalimantan': {
                icon: '🛶',
                title: 'Rumah Panjang',
                description: 'Rumah adat suku Dayak yang dihuni oleh banyak keluarga.',
                color: '#16a34a',
                imageUrl: 'https://placehold.co/400x200/16a34a/ffffff?text=Rumah+Panjang'
            },
            'Sulawesi': {
                icon: '⛵',
                title: 'Perahu Pinisi',
                description: 'Perahu layar tradisional Suku Bugis yang tangguh mengarungi samudra.',
                color: '#0ea5e9',
                imageUrl: 'https://placehold.co/400x200/0ea5e9/ffffff?text=Perahu+Pinisi'
            },
            'Papua': {
                icon: '🎶',
                title: 'Noken',
                description: 'Tas tradisional rajutan tangan yang menjadi warisan budaya UNESCO.',
                color: '#dc2626',
                imageUrl: 'https://placehold.co/400x200/dc2626/ffffff?text=Noken'
            }
        };

        function displayCulture(region) {
            const data = cultureData[region];
            cultureDisplay.innerHTML = `
                <div class="flex flex-col items-center justify-center p-4">
                    <img src="${data.imageUrl}" alt="${data.title}" class="culture-image" onerror="this.onerror=null;this.src='https://placehold.co/400x200/cccccc/000000?text=Gambar+Tidak+Tersedia';">
                    <div class="text-6xl mb-2">${data.icon}</div>
                    <h4 class="font-bold text-lg">${data.title}</h4>
                </div>
                <div class="md:col-span-2 flex items-center justify-center p-4">
                    <p class="text-slate-600">${data.description}</p>
                </div>
            `;
            // Mainkan suara saat budaya ditampilkan
            synth.triggerAttackRelease('C5', '8n');
        }

        Object.keys(cultureData).forEach(region => {
            const button = document.createElement('button');
            button.className = 'sub-topic-button text-white font-bold py-2 px-4 rounded-lg';
            button.textContent = region;
            button.style.backgroundColor = cultureData[region].color;
            button.onclick = () => displayCulture(region);
            cultureButtonsContainer.appendChild(button);
        });

        displayCulture('Jawa'); // Tampilkan Jawa sebagai default

        // --- Section 4: Aku & Masyarakat ---
        const responsibilitiesContainer = document.getElementById('responsibilities-container');
        const rolesContainer = document.getElementById('roles-container');
        const dropZones = document.querySelectorAll('.drop-zone');
        const feedbackMessage = document.getElementById('feedback-message');

        const responsibilities = [
            { text: 'Mengerjakan PR', role: 'Siswa' },
            { text: 'Membersihkan kamar', role: 'Anak' },
            { text: 'Ikut kerja bakti', role: 'Warga' },
            { text: 'Piket kelas', role: 'Siswa' },
            { text: 'Menghormati orang tua', role: 'Anak' },
            { text: 'Membuang sampah pada tempatnya', role: 'Warga' },
        ];
        
        // Acak array
        responsibilities.sort(() => Math.random() - 0.5);

        responsibilities.forEach((item, index) => {
            const div = document.createElement('div');
            div.id = `resp-${index}`;
            div.className = 'p-3 bg-white rounded-lg shadow cursor-grab active:cursor-grabbing';
            div.textContent = item.text;
            div.draggable = true;
            div.dataset.role = item.role;
            responsibilitiesContainer.appendChild(div);
        });

        const draggables = document.querySelectorAll('[draggable="true"]');

        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => {
                draggable.classList.add('opacity-50');
                // Mainkan suara saat item diseret
                synth.triggerAttackRelease('C4', '32n');
            });
            draggable.addEventListener('dragend', () => {
                draggable.classList.remove('opacity-50');
            });
        });

        dropZones.forEach(zone => {
            zone.addEventListener('dragover', e => {
                e.preventDefault();
                zone.classList.add('bg-rose-200');
            });
            zone.addEventListener('dragleave', () => {
                zone.classList.remove('bg-rose-200');
            });
            zone.addEventListener('drop', e => {
                e.preventDefault();
                zone.classList.remove('bg-rose-200');
                const id = e.dataTransfer.getData('text/plain');
                const draggableElement = document.getElementById(id);

                if (draggableElement.dataset.role === zone.dataset.role) {
                    zone.appendChild(draggableElement);
                    draggableElement.draggable = false;
                    draggableElement.style.cursor = 'default';
                    draggableElement.classList.add('bg-green-200', 'border', 'border-green-500');
                    feedbackMessage.textContent = 'Hebat, itu benar!';
                    feedbackMessage.className = 'text-center mt-4 font-bold h-6 text-green-600';
                    // Mainkan suara benar
                    synth.triggerAttackRelease('E5', '8n');
                } else {
                    feedbackMessage.textContent = 'Oops, coba lagi ya!';
                    feedbackMessage.className = 'text-center mt-4 font-bold h-6 text-red-600';
                    // Mainkan suara salah
                    synth.triggerAttackRelease('C2', '8n');
                }
                 setTimeout(() => { feedbackMessage.textContent = ''; }, 2000);
            });
        });

        responsibilitiesContainer.addEventListener('dragstart', e => {
            if(e.target.draggable) {
                 e.dataTransfer.setData('text/plain', e.target.id);
            }
        });

    });
    </script>
</body>
</html>
